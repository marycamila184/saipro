<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="ISO-8859-1"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">
<title>SAIPRO - Sistema de Análise de Imagens Panorâmicas e
	Radiologias Odontológicas</title>
<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

<!-- Custom fonts for this template -->
<link href="vendor/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">
<link
	href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
	rel='stylesheet' type='text/css'>
<link
	href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic'
	rel='stylesheet' type='text/css'>
<!-- Plugin CSS -->
<link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="css/creative.css" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


</head>
<body id="page-top">

	<!-- Navigation -->
	<nav class="navbar navbar-expand-lg navbar-light fixed-top"
		id="mainNav">
	<div class="container">

		<button class="navbar-toggler navbar-toggler-right" type="button"
			data-toggle="collapse" data-target="#navbarResponsive"
			aria-controls="navbarResponsive" aria-expanded="false"
			aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarResponsive">
			<ul class="navbar-nav ml-auto">
				<li class="nav-item"><a class="nav-link js-scroll-trigger"
					href="#sobre">SOBRE</a></li>
				<li class="nav-item"><a class="nav-link js-scroll-trigger"
					href="#como-funciona">COMO FUNCIONA</a></li>
				<li class="nav-item"><a class="nav-link js-scroll-trigger"
					href="#testar">TESTAR</a></li>
				<li class="nav-item"><a class="nav-link js-scroll-trigger"
					href="#contact">CONTATO</a></li>
			</ul>
		</div>
	</div>
	</nav>

	<header class="masthead div-header">
	<div class="header-content">
		<div class="header-content-inner">
			<h1 id="homeHeading">Sistema de Análise de Imagens Panorâmicas e
				Radiologias Odontológicas</h1>
			<hr>
			<p>SAIPRO é um projeto de pesquisa afim de ajudar a área
				odontológica, atuando como um ajudante no diagnóstico de anomalias
				na região da mandíbula em radiografias panorâmicas.</p>
			<a class="btn btn-primary btn-xl js-scroll-trigger" href="#sobre">
				SAIBA MAIS</a>
		</div>
	</div>
	</header>

	<section class="bg-primary" id="sobre">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 mx-auto text-center">
				<h2 class="section-heading text-white">SOBRE</h2>
				<hr class="light">
				<p class="text-faded">O projeto de pesquisa está sendo
					desenvolvido na Universidade Positivo como projeto de TCC por
					alunos do curso de Sistemas de Informação e tem como objetivo
					diminuir a dificuldade no diagnóstico de doenças odontológicas
					difíceis de identificar em radiografias panorâmicas, mediante a
					análise e comparação de padrões encontrados nessas doenças</p>
				<a class="btn btn-default btn-xl js-scroll-trigger" href="#testar">TESTAR
					AGORA</a>
			</div>
		</div>
	</div>
	</section>

	<section id="como-funciona">
	<div class="container">
		<div class="row">
			<div class="col-lg-12 text-center">
				<h2 class="section-heading">COMO FUNCIONA?</h2>
				<hr class="primary">
			</div>
		</div>
	</div>
	<div class="container">
		<div class="row">
			<div class="col-lg-3 col-md-6 text-center">
				<div class="service-box">
					<i class="fa fa-4x fa-connectdevelop text-primary sr-icons"></i>
					<h3>Anomalias</h3>
					<p class="text-muted">O projeto trabalha exclusivamente com
						radiografias panorâmicas odontológicas e focamos para mostrar
						pontos de atenção na imagem do exame.</p>
				</div>
			</div>
			<div class="col-lg-3 col-md-6 text-center">
				<div class="service-box">
					<i class="fa fa-4x fa-cogs text-primary sr-icons"></i>
					<h3>Tecnologia</h3>
					<p class="text-muted">Para podermos destacar as anomalias
						utilizamos processamento de imagens juntamente com mineração de
						dados para saber se a mancha encontrada é uma anomalia.</p>
				</div>
			</div>
			<div class="col-lg-3 col-md-6 text-center">
				<div class="service-box">
					<i class="fa fa-4x fa-user-md text-primary sr-icons"></i>
					<h3>Mandíbula</h3>
					<p class="text-muted">Todo o projeto está sendo focado na área
						da mandíbula das radiografias panorâmicas sendo que qualquer
						resultado que não estiver nesta região pode ser descartado.</p>
				</div>
			</div>
			<div class="col-lg-3 col-md-6 text-center">
				<div class="service-box">
					<i class="fa fa-4x fa-crosshairs text-primary sr-icons"></i>
					<h3>Resultado</h3>
					<p class="text-muted">Após uma série de filtros podemos dizer
						se há ou não anomalias no exame, ajudando os profissionais da área
						odontológica no diagnóstico dos pacientes.</p>
				</div>
			</div>
		</div>
	</div>
	</section>

	<section class="bg-primary" id="testar">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 mx-auto text-center">
				<h2 class="section-heading text-white">TESTAR</h2>
				<hr class="light">
				<p class="text-faded">Tire uma foto do exame centralizado sem
					bordas em um negatoscópio, procure no seu dispositivo a imagem e
					faça o upload para o nosso servidor utilizando os botões abaixo e
					logo você receberá os resultados encontrados.</p>
			</div>
		</div>
	</div>
	<div class="container">
		<div class="row">
			<div class="col-lg-12 col-md-12">
				<center>
					<div id="button-responsive"></div>
				</center>
			</div>
			<div class="col-lg-12 col-md-12">
				<center>
					<div id="span-old-exam">
						<span class="span-step" style="font-size: 15px"> Exame a
							ser analisado</span>
					</div>
				</center>
			</div>
			<div class="col-lg-12 col-md-12">
				<center>
					<img class="img-responsive img-exam" id="old-exam" />
				</center>
			</div>
			<div class="col-lg-12 col-md-12">
				<center>
					<img class="img-responsive img-exam" id="two-exame" />
				</center>
			</div>
			<div class="col-lg-12 col-md-12">
				<center>


					<div id="status-1-loading">
						<i class="fa fa-spinner fa-pulse fa-3x fa-fw fa-span"></i> <span
							class="span-step"> Extraindo região da mandíbula para
							análise ...</span>
					</div>
					<div id="status-1-ok">
						<i class="fa fa-check fa-span"></i> <span class="span-step">
							Extraindo região da mandíbula para análise </span>
					</div>


					<div id="status-2-loading">
						<i class="fa fa-spinner fa-pulse fa-3x fa-fw fa-span"></i> <span
							class="span-step"> Procurando por regiões de atenção ...</span>
					</div>
					<div id="status-2-ok">
						<i class="fa fa-check fa-span"></i> <span class="span-step">
							Procurando por regiões de atenção </span>
					</div>


					<div id="status-3-loading">
						<i class="fa fa-spinner fa-pulse fa-3x fa-fw fa-span"></i> <span
							class="span-step"> Classificando em anomalias as regiões
							de atenção encontradas ...</span>
					</div>
					<div id="status-3-ok">
						<i class="fa fa-check fa-span"></i> <span class="span-step">
							Classificando em anomalias as regiões de atenção encontradas</span>
					</div>


					<div id="status-4-loading">
						<i class="fa fa-spinner fa-pulse fa-3x fa-fw fa-span"></i> <span
							class="span-step"> Processando o resultado final ...</span>
					</div>
					<div id="status-4-ok">
						<i class="fa fa-check fa-span"></i> <span class="span-step">
							Processando o resultado final</span>
					</div>
					<div id="status-5">
						<i class="fa fa-check fa-span"></i> <span class="span-step">
							Exame analisado com sucesso!</span>
					</div>
				</center>
			</div>

			<div class="col-lg-12 col-md-12">
				<center>
					<div id="resultado">
						<img id="image-result" class="img-responsive" />
					</div>
				</center>
			</div>
		</div>
	</div>
	</section>

	<section id="contact">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 mx-auto text-center">
				<h2 class="section-heading">CONTATO</h2>
				<hr class="primary">
				<p>Ficou interessado em nosso projeto? Quer saber mais detalhes?
					Tem alguma sugestão? Entre em contato conosco através dos dados
					abaixo!</p>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-4 ml-auto text-center">
				<i class="fa fa-phone fa-3x sr-contact"></i>
				<p>(41) 3048-0952</p>
			</div>
			<div class="col-lg-4 mr-auto text-center">
				<i class="fa fa-envelope-o fa-3x sr-contact"></i>
				<p>
					<a href="mailto:saipro@gmail.com">saipro@gmail.com</a>
				</p>
			</div>
		</div>
	</div>
	</section>

	<footer>
	<div class="container">
		<div class="row">

			<div class="col-md-6">
				<span class="copyright">Copyright © SAIPRO 2017</span>
			</div>
			<div class="col-md-6">
				<div class="img-header-nav">
					<img id="img-nav" src="img/saipro.png" class="img-responsive" />
				</div>
			</div>
		</div>
	</div>
	</div>
	</footer>

	<script src="vendor/jquery/jquery.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

	<!-- Plugin JavaScript -->
	<script src="vendor/jquery-easing/jquery.easing.min.js"></script>
	<script src="vendor/scrollreveal/scrollreveal.min.js"></script>
	<script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

	<!-- Custom scripts for this template -->
	<script src="js/creative.min.js"></script>
</body>

<script>
	var isMobile = {
		Android : function() {
			return navigator.userAgent.match(/Android/i);
		},
		BlackBerry : function() {
			return navigator.userAgent.match(/BlackBerry/i);
		},
		iOS : function() {
			return navigator.userAgent.match(/iPhone|iPad|iPod/i);
		},
		Opera : function() {
			return navigator.userAgent.match(/Opera Mini/i);
		},
		Windows : function() {
			return navigator.userAgent.match(/IEMobile/i);
		},
		any : function() {
			return (isMobile.Android() || isMobile.BlackBerry()
					|| isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
		}
	};

	if (isMobile.any() != null) {
		$('#button-responsive')
				.html(
						'<input id="process-image" type="file" class="btn btn-default btn-xl" />');

		document.getElementById('process-image').onchange = function(event) {
			var files = event.target.files;
			var file = files[0];
			upload(file);
		};

	} else {
		$('#button-responsive').html(
				'<div id="dropbox">Arraste e solte aqui o exame</div>');
		var dropbox = document.getElementById("dropbox");
		dropbox.addEventListener("dragenter", noop, false);
		dropbox.addEventListener("dragexit", noop, false);
		dropbox.addEventListener("dragover", noop, false);
		dropbox.addEventListener("drop", dropUpload, false);
	}

	function noop(event) {
		event.stopPropagation();
		event.preventDefault();
	}

	function dropUpload(event) {
		document.getElementById("span-old-exam").style.display = "none";
		document.getElementById("image-result").style.display = "none";
		noop(event);
		var files = event.dataTransfer.files;
		getOldExame(files[0]);
	}

	//Imagem antiga
	function getOldExame(file) {
		document.getElementById("status-1-loading").style.display = "block";
		document.getElementById("status-1-ok").style.display = "none";
		document.getElementById("status-2-loading").style.display = "block";
		document.getElementById("status-2-ok").style.display = "none";
		document.getElementById("status-3-loading").style.display = "block";
		document.getElementById("status-3-ok").style.display = "none";
		document.getElementById("status-4-loading").style.display = "block";
		document.getElementById("status-4-ok").style.display = "none";
		document.getElementById("status-5").style.display = "none";

		var formData = new FormData();
		formData.append("file", file);

		var xhr = new XMLHttpRequest();
		xhr.open("POST", "ReturnOldRadiography", true);
		xhr.responseType = 'blob';
		xhr.onload = responseOldImage;
		xhr.send(formData);
	}

	function responseOldImage(e) {
		document.getElementById("span-old-exam").style.display = "block";
		var urlCreator = window.URL || window.webkitURL;
		var imageUrl = urlCreator.createObjectURL(this.response);
		document.querySelector("#old-exam").src = imageUrl;
		getMandible(this.response);
	}

	//Imagem mandibula	
	function getMandible(blob) {
		var formData = new FormData();
		formData.append("file", blob);
		var xhr = new XMLHttpRequest();
		xhr.open("POST", "SegmentMandibleServlet", true);
		xhr.responseType = 'blob';
		xhr.onload = updateStatusMandible;
		xhr.send(formData);
	}

	function updateStatusMandible(e) {
		document.getElementById("status-1-loading").style.display = "none";
		document.getElementById("status-1-ok").style.display = "block";
		document.getElementById("status-2-loading").style.display = "block";
		document.getElementById("status-2-ok").style.display = "none";
		document.getElementById("status-3-loading").style.display = "block";
		document.getElementById("status-3-ok").style.display = "none";
		document.getElementById("status-4-loading").style.display = "block";
		document.getElementById("status-4-ok").style.display = "none";
		document.getElementById("status-5").style.display = "none";

		var urlCreator = window.URL || window.webkitURL;
		var imageUrl = urlCreator.createObjectURL(this.response);
		getSpots(this.response);
	}

	//Imagem manchas
	function getSpots(blob) {
		var formData = new FormData();
		formData.append("file", blob);
		var xhr = new XMLHttpRequest();
		xhr.open("POST", "CreateMaskSpot", true);
		xhr.responseType = 'json';
		xhr.onload = updateStatusSpots;
		xhr.send(formData);
	}

	function updateStatusSpots(e) {
		document.getElementById("status-1-loading").style.display = "none";
		document.getElementById("status-1-ok").style.display = "block";
		document.getElementById("status-2-loading").style.display = "none";
		document.getElementById("status-2-ok").style.display = "block";
		document.getElementById("status-3-loading").style.display = "block";
		document.getElementById("status-3-ok").style.display = "none";
		document.getElementById("status-4-loading").style.display = "block";
		document.getElementById("status-4-ok").style.display = "none";
		document.getElementById("status-5").style.display = "none";

		getClassification(this.response);
	}

	//Classificação
	function getClassification(json) {
		var xhr = new XMLHttpRequest();
		xhr.open("POST", "ClassificationRadiography", true);
		xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhr.responseType = 'json';
		xhr.onload = updateStatusClassification;
		xhr.send('object=' + JSON.stringify(json));
	}

	function updateStatusClassification(e) {
		document.getElementById("status-1-loading").style.display = "none";
		document.getElementById("status-1-ok").style.display = "block";
		document.getElementById("status-2-loading").style.display = "none";
		document.getElementById("status-2-ok").style.display = "block";
		document.getElementById("status-3-loading").style.display = "none";
		document.getElementById("status-3-ok").style.display = "block";
		document.getElementById("status-4-loading").style.display = "block";
		document.getElementById("status-4-ok").style.display = "none";
		document.getElementById("status-5").style.display = "none";

		getFinalResult(this.response);		
	}
	
	//Resultado Final
	function getFinalResult(json) {
		console.log(json);
		var xhr = new XMLHttpRequest();
		xhr.open("POST", "FinalResult", true);
		xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhr.responseType = 'blob';
		xhr.onload = updateStatusResultadoFinal;
		xhr.send('object=' + JSON.stringify(json));
	}
	
	function updateStatusResultadoFinal(e) {
		document.getElementById("status-1-loading").style.display = "none";
		document.getElementById("status-1-ok").style.display = "block";
		document.getElementById("status-2-loading").style.display = "none";
		document.getElementById("status-2-ok").style.display = "block";
		document.getElementById("status-3-loading").style.display = "none";
		document.getElementById("status-3-ok").style.display = "block";
		document.getElementById("status-4-loading").style.display = "none";
		document.getElementById("status-4-ok").style.display = "block";
		
		//Carregar a imagem
		document.getElementById("image-result").style.display = "block";
		var urlCreator = window.URL || window.webkitURL;
		var imageUrl = urlCreator.createObjectURL(this.response);
		document.querySelector("#image-result").src = imageUrl;
		
		console.log(this.response);
		
		document.getElementById("status-5").style.display = "block";
	}
</script>
</html>